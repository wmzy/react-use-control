{"version":3,"file":"control-2b137f26.js","sources":["../../src/control.js"],"sourcesContent":["import {useState, useRef, useCallback} from 'react';\n\n// If the state change, control should update reference, so that the\n// react memo not be broken.\nconst oldControls = new WeakSet();\nconst base = {useState};\n\nfunction create(baseControl) {\n  return Object.create(baseControl || base);\n}\n\nexport function isControl(maybeControl) {\n  return maybeControl instanceof base;\n}\n\nfunction useNewControl(baseControl) {\n  const baseRef = useRef(baseControl);\n  const newCtl = create(baseControl);\n  const ref = useRef(newCtl);\n  if (baseRef.current !== baseControl) {\n    baseRef.current = baseControl;\n    ref.current = newCtl;\n  } else if (oldControls.has(ref.current)) {\n    ref.current = newCtl;\n  }\n  return ref.current;\n}\n\nexport function useControl(control, initial) {\n  const ctrl = useNewControl(control);\n  const {state, useState} = ctrl;\n\n  if (Object.getPrototypeOf(ctrl).state) return [...state, ctrl];\n\n  const [value, setValue] = useState(initial);\n  const wrappedSetValue = useCallback((v) => {\n    setValue((oldValue) => {\n      const newValue = typeof v === 'function' ? v(oldValue) : v;\n      if (!Object.is(newValue, oldValue)) oldControls.add(ctrl);\n      return newValue;\n    });\n  }, []);\n  ctrl.state = [value, wrappedSetValue];\n\n  return [value, wrappedSetValue, ctrl];\n}\n\nexport function useThru(control, interceptor) {\n  const ctrl = useNewControl(control);\n  const {state, useState} = ctrl;\n  if (Object.getPrototypeOf(ctrl).state) {\n    ctrl.state = interceptor(state);\n  } else {\n    ctrl.useState = (...params) => interceptor(useState(...params));\n  }\n  return ctrl;\n}\n"],"names":["oldControls","base","useState","create","baseControl","useNewControl","baseRef","useRef","newCtl","ref","useControl","control","initial","ctrl","state","value","setValue","wrappedSetValue","useCallback","v","oldValue","newValue","useThru","interceptor","params"],"mappings":"wCAIA,MAAMA,EAAc,IAAI,QAClBC,EAAO,CAACC,SAAAA,EAAAA,QAAQ,EAEtB,SAASC,EAAOC,EAAa,CAC3B,OAAO,OAAO,OAAOA,GAAeH,CAAI,CAC1C,CAMA,SAASI,EAAcD,EAAa,CAClC,MAAME,EAAUC,SAAOH,CAAW,EAC5BI,EAASL,EAAOC,CAAW,EAC3BK,EAAMF,SAAOC,CAAM,EACzB,OAAIF,EAAQ,UAAYF,GACtBE,EAAQ,QAAUF,EAClBK,EAAI,QAAUD,GACLR,EAAY,IAAIS,EAAI,OAAO,IACpCA,EAAI,QAAUD,GAETC,EAAI,OACb,CAEO,SAASC,EAAWC,EAASC,EAAS,CAC3C,MAAMC,EAAOR,EAAcM,CAAO,EAC5B,CAAC,MAAAG,EAAO,SAAAZ,CAAQ,EAAIW,EAE1B,GAAI,OAAO,eAAeA,CAAI,EAAE,MAAO,MAAO,CAAC,GAAGC,EAAOD,CAAI,EAE7D,KAAM,CAACE,EAAOC,CAAQ,EAAId,EAASU,CAAO,EACpCK,EAAkBC,cAAaC,GAAM,CACzCH,EAAUI,GAAa,CACrB,MAAMC,EAAW,OAAOF,GAAM,WAAaA,EAAEC,CAAQ,EAAID,EACzD,OAAK,OAAO,GAAGE,EAAUD,CAAQ,GAAGpB,EAAY,IAAIa,CAAI,EACjDQ,CACb,CAAK,CACF,EAAE,CAAE,CAAA,EACL,OAAAR,EAAK,MAAQ,CAACE,EAAOE,CAAe,EAE7B,CAACF,EAAOE,EAAiBJ,CAAI,CACtC,CAEO,SAASS,EAAQX,EAASY,EAAa,CAC5C,MAAMV,EAAOR,EAAcM,CAAO,EAC5B,CAAC,MAAAG,EAAO,SAAAZ,CAAQ,EAAIW,EAC1B,OAAI,OAAO,eAAeA,CAAI,EAAE,MAC9BA,EAAK,MAAQU,EAAYT,CAAK,EAE9BD,EAAK,SAAW,IAAIW,IAAWD,EAAYrB,EAAS,GAAGsB,CAAM,CAAC,EAEzDX,CACT"}